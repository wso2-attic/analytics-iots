<domain name="HistoricAnalyticsDomain">
    <description>Domain for historic sensor data analysis</description>
    <scenarios>
        <scenario type="HistoricalAnalytics">
            <description>Configure a historic sensor analytics scenario to display statistics for a given stream of your
                choice
            </description>
            <templates>
                <!--Note: These will be deployed in the order they appear here-->
                <template type="eventstream">
                    {
                        "name": "org.wso2.iot.devices.sensors.${toId('$sensorType')}",
                        "version": "1.0.0",
                        "nickName": "",
                        "description": "",
                        "metaData": [
                            {"name":"owner","type":"STRING"},
                            {"name":"deviceType","type":"STRING"},
                            {"name":"deviceId","type":"STRING"},
                            {"name":"time","type":"LONG"}
                        ],
                        "payloadData": [
                            {
                            "name": "sensor_value",
                            "type": "DOUBLE"
                            }
                        ]
                    }
                </template>
                <template type="eventsink">
                    <![CDATA[
                <EventStoreConfiguration>
                     <TableSchema>
                        <ColumnDefinition>
                            <Name>meta_owner</Name>
                            <EnableIndexing>true</EnableIndexing>
                            <IsPrimaryKey>true</IsPrimaryKey>
                            <EnableScoreParam>false</EnableScoreParam>
                            <Type>STRING</Type>
                        </ColumnDefinition>
                        <ColumnDefinition>
                            <Name>meta_deviceType</Name>
                            <EnableIndexing>true</EnableIndexing>
                            <IsPrimaryKey>true</IsPrimaryKey>
                            <EnableScoreParam>false</EnableScoreParam>
                            <Type>STRING</Type>
                        </ColumnDefinition>
                        <ColumnDefinition>
                            <Name>meta_deviceId</Name>
                            <EnableIndexing>true</EnableIndexing>
                            <IsPrimaryKey>true</IsPrimaryKey>
                            <EnableScoreParam>false</EnableScoreParam>
                            <Type>STRING</Type>
                        </ColumnDefinition>
                        <ColumnDefinition>
                            <Name>meta_time</Name>
                            <EnableIndexing>true</EnableIndexing>
                            <IsPrimaryKey>true</IsPrimaryKey>
                            <EnableScoreParam>false</EnableScoreParam>
                            <Type>LONG</Type>
                        </ColumnDefinition>
                        <ColumnDefinition>
                            <Name>sensor_value</Name>
                            <IsFacet>false</IsFacet>
                            <EnableIndexing>false</EnableIndexing>
                            <IsPrimaryKey>true</IsPrimaryKey>
                            <EnableScoreParam>false</EnableScoreParam>
                            <Type>DOUBLE</Type>
                        </ColumnDefinition>
                     </TableSchema>
                     <Source>
                        <StreamId>org.wso2.iot.devices.sensors.${toId('$sensorType')}:1.0.0</StreamId>
                     </Source>
                     <MergeSchema>false</MergeSchema>
                     <RecordStoreName>EVENT_STORE</RecordStoreName>
                </EventStoreConfiguration>
                ]]>
                </template>
                <template type="batch">
                    <executionParameters>
                        <sparkScript>
                            <![CDATA[
                                CREATE TEMPORARY TABLE Device${toId('$sensorType')}Data USING CarbonAnalytics OPTIONS(tableName "ORG_WSO2_IOT_DEVICES_SENSORS_${toId('$sensorType')}");

                                CREATE TEMPORARY TABLE Device${toId('$sensorType')}SummaryData USING CarbonAnalytics OPTIONS (tableName "DEVICE_${toId('$sensorType')}_SUMMARY",
                                schema "sensor_value DOUBLE, deviceType STRING -i, deviceId STRING -i, owner STRING -i, time_stamp LONG -i",primaryKeys "time_stamp",
                                incrementalProcessing "Device${toId('$sensorType')}SummaryData, 60, 2", mergeSchema "false");

                                insert INTO table Device${toId('$sensorType')}SummaryData select sensor_value, meta_deviceType as deviceType, meta_deviceId as deviceId, meta_owner as owner,
                                meta_time*1000 as time_stamp from Device${toId('$sensorType')}Data group by sensor_value, meta_deviceType, meta_deviceId, meta_owner, meta_time;

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerSecond USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Second",
                                schema "year INT -i, month INT -i, day INT -i, hour INT -I, minute INT -i, second INT -i, total DOUBLE -i, minValue DOUBLE -i,
                                maxValue DOUBLE -i, noOfInvocation INT -I, time LONG -i, deviceId STRING -i",
                                primaryKeys "year, month, day, hour, minute, second, deviceId",
                                mergeSchema "false");

                                INSERT INTO TABLE ${toId('$sensorType')}ServiceStatPerSecond
                                SELECT year, month, day, hour, minute, second,total, minValue, maxValue, noOfInvocation, time, deviceId
                                FROM
                                (SELECT temp.year, temp.month, temp.day, temp.hour, temp.minute, temp.second,
                                sum(temp.sensor_value) as total,
                                min(temp.sensor_value) as minValue, max(temp.sensor_value) as maxValue, count(*) as noOfInvocation, getSecondStartingTime(year, month, day,
                                hour, minute, second) as time, temp.deviceId
                                FROM
                                 (SELECT getYear(time_stamp) as year, getMonth(time_stamp) as month, getDay(time_stamp) as day, getHour(time_stamp)
                                as hour, getMinute(time_stamp) as minute, getSeconds(time_stamp) as second, sensor_value , deviceId, owner FROM Device${toId('$sensorType')}SummaryData) temp
                                GROUP BY temp.year, temp.month, temp.day, temp.hour, temp.minute, temp.second, temp.deviceId) result;

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerSecond USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Second", incrementalProcessing "${toId('$sensorType')}ServiceStatPerSecond, 60, 2");

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerMinute USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Minute",
                                schema "year INT -i, month INT -i, day INT -i, hour INT -I, minute INT -i, total DOUBLE -i, minValue DOUBLE -i,
                                maxValue DOUBLE -i, noOfInvocation INT -I, time LONG -i, deviceId STRING -i",
                                primaryKeys "year, month, day, hour, minute, deviceId",
                                mergeSchema "false");

                                INSERT INTO TABLE ${toId('$sensorType')}ServiceStatPerMinute
                                SELECT year, month, day, hour, minute,
                                sum(total) as total, min(minValue) as minValue, max(maxValue) as maxValue, count(*) as noOfInvocation,
                                getMinuteStartingTime(year, month, day, hour, minute) as time, deviceId
                                FROM ${toId('$sensorType')}ServiceStatPerSecond
                                GROUP BY year, month, day, hour, minute, deviceId ORDER BY year, month, day, hour, minute ASC;

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerMinute USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Minute", incrementalProcessing "${toId('$sensorType')}ServiceStatPerMinute, 3600");

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerHour USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Hour",
                                schema "year INT -i, month INT -i, day INT -i, hour INT -I, total DOUBLE -i, minValue DOUBLE -i,
                                maxValue DOUBLE -i, noOfInvocation INT -I, time LONG -i, deviceId STRING -i",
                                primaryKeys "year, month, day, hour, deviceId",
                                mergeSchema "false");

                                INSERT INTO TABLE ${toId('$sensorType')}ServiceStatPerHour
                                SELECT year, month, day, hour, sum(total) as total, min(minValue) as minValue, max(maxValue) as maxValue,
                                 count(*) as noOfInvocation, getHourStartingTime(year, month, day, hour) as time, deviceId
                                FROM ${toId('$sensorType')}ServiceStatPerMinute
                                GROUP BY year, month, day, hour, deviceId ORDER BY year, month, day, hour ASC;

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerHour USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Hour",
                                incrementalProcessing "${toId('$sensorType')}ServiceStatPerHour, 86400");

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerDay USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Day",
                                schema "year INT -i, month INT -i, day INT -i, total DOUBLE -i, minValue DOUBLE -i,
                                maxValue DOUBLE -i, noOfInvocation INT -I, time LONG -i, deviceId STRING -i",
                                primaryKeys "year, month, day, deviceId",
                                mergeSchema "false");

                                INSERT INTO TABLE ${toId('$sensorType')}ServiceStatPerDay
                                SELECT year, month, day, sum(total) as total, min(minValue) as minValue, max(maxValue) as maxValue, count(*) as noOfInvocation,
                                getDateStartingTime(year, month, day) as time, deviceId FROM ${toId('$sensorType')}ServiceStatPerHour
                                GROUP BY year, month, day, deviceId ORDER BY year, month, day ASC;

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerDay USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Day",
                                incrementalProcessing "${toId('$sensorType')}ServiceStatPerDay, 604800");

                                CREATE TEMPORARY TABLE ${toId('$sensorType')}ServiceStatPerMonth USING CarbonAnalytics
                                OPTIONS (tableName "Service-${toId('$sensorType')}-Stat-Per-Month",
                                schema "year INT -i, month INT -i, total DOUBLE -i, minValue DOUBLE -i,
                                maxValue DOUBLE -i, noOfInvocation INT -I, time LONG -i, deviceId STRING -i",
                                primaryKeys "year, month, deviceId",
                                mergeSchema "false");

                                INSERT INTO TABLE ${toId('$sensorType')}ServiceStatPerMonth
                                SELECT year, month, sum(total) as total, min(minValue) as minValue, max(maxValue) as maxValue, count(*) as noOfInvocation,
                                getMonthStartingTime(year, month) as time, deviceId FROM ${toId('$sensorType')}ServiceStatPerDay
                                GROUP BY year, month, deviceId ORDER BY year, month ASC;
                             ]]>
                        </sparkScript>
                        <cron>0 0/5 * * * ?</cron>
                    </executionParameters>
                </template>
                <template type="gadget">
                    <config>
                        <properties>
                            <property name="directoryName">${toId('$sensorType')}-historical-value-chart-min</property>
                            <property name="templateDirectory">HistoricalValueChart</property>
                        </properties>
                        <artifacts>
                            <artifact file="conf.json">
                                <![CDATA[
                                    {
                                      "provider-conf": {
                                        "control1": "default value",
                                        "tableName": "Service-${toId('$sensorType')}-Stat-Per-Second",
                                        "provider-name": "batch",
                                        "time-from":"0",
                                        "time-to":"9007199254740992"
                                      },
                                      "chart-conf": {
                                        "x": "time",
                                        "y": "minValue",
                                        "color": "None",
                                        "mode": "stack",
                                        "gadget-name": "${toId('$sensorType')}-historical-value-chart-min",
                                        "chart-name": "bar-chart"
                                      }
                                    }
                                ]]>
                            </artifact>
                            <artifact file="gadget.json">
                                <![CDATA[
                                {
                                    "id": "${toId('$sensorType')}-historical-value-chart-min",
                                    "title": "${toId('$sensorType')}-historical-value-chart-min",
                                    "type": "gadget",
                                    "thumbnail": "gadget/${toId('$sensorType')}-historical-value-chart-min/index.png",
                                    "data": {
                                        "url": "gadget/${toId('$sensorType')}-historical-value-chart-min/index.xml"
                                    },
                                    "listen": {
                                      "subscriber": {
                                        "type": "time-range",
                                        "description": "Used for listen to get time range from time-range picker"
                                      }
                                    }
                                }
                                ]]>
                            </artifact>
                            <artifact file="js/gadget-core.js">
                                <![CDATA[
                                   /*
                                    * Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
                                    *
                                    * Licensed under the Apache License, Version 2.0 (the "License");
                                    * you may not use this file except in compliance with the License.
                                    * You may obtain a copy of the License at
                                    *
                                    * http://www.apache.org/licenses/LICENSE-2.0
                                    *
                                    * Unless required by applicable law or agreed to in writing, software
                                    * distributed under the License is distributed on an "AS IS" BASIS,
                                    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                    * See the License for the specific language governing permissions and
                                    * limitations under the License.
                                    */
                                    var conf;
                                    var drawGadget;
                                    var refreshIntervalId;

                                    $(function () {
                                    var gadgetLocation = '/portal/store/carbon.super/fs/gadget/${toId('$sensorType')}-historical-value-chart-min';
                                        var schema;
                                        var pref = new gadgets.Prefs();

                                        var refreshInterval;
                                        var providerData;

                                        var CHART_CONF = 'chart-conf';
                                        var PROVIDER_CONF = 'provider-conf';

                                        var REFRESH_INTERVAL = 'refreshInterval';

                                    var init = function () {
                                        $.ajax({
                                            url: gadgetLocation + '/conf.json',
                                            method: "GET",
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                                conf = JSON.parse(data);
                                                $.ajax({
                                                    url: gadgetLocation + '/gadget-controller.jag?action=getSchema',
                                                    method: "POST",
                                                    data: JSON.stringify(conf),
                                                    contentType: "application/json",
                                                    async: false,
                                                    success: function (data) {
                                                        schema = data;
                                                    }
                                                });

                                                getProviderData();

                                               }
                                           });
                                    }

                                    var getProviderData = function (){
                                        $.ajax({
                                            url: gadgetLocation + '/gadget-controller.jag?action=getData',
                                            method: "POST",
                                            data: JSON.stringify(conf),
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                            providerData = data;
                                            }
                                        });
                                    }


                                        drawGadget = function (){

                                        draw('#canvas', conf[CHART_CONF], schema, providerData);
                                        refreshIntervalId = setInterval(function() {
                                            update(getProviderData);
                                        },pref.getInt(REFRESH_INTERVAL));

                                    }
                                        init();
                                        drawGadget();
                                    });

                                    gadgets.HubSettings.onConnect = function () {
                                        gadgets.Hub.subscribe("subscriber", function (topic, data, subscriber) {
                                            console.log("-conf--"+ conf["provider-conf"]["time-from"]);
                                            conf["provider-conf"]["time-from"] = data.timeFrom;
                                            conf["provider-conf"]["time-to"] =  data.timeTo;
                                            if(refreshIntervalId) {
                                                clearInterval(refreshIntervalId);
                                            }
                                            if(drawGadget){
                                                drawGadget();
                                            }
                                        });
                                    };
                                ]]>
                            </artifact>
                        </artifacts>
                    </config>
                </template>
                <template type="gadget">
                    <config>
                        <properties>
                            <property name="directoryName">${toId('$sensorType')}-historical-value-chart-max</property>
                            <property name="templateDirectory">HistoricalValueChart</property>
                        </properties>
                        <artifacts>
                            <artifact file="conf.json">
                                <![CDATA[
                                    {
                                      "provider-conf": {
                                        "control1": "default value",
                                        "tableName": "Service-${toId('$sensorType')}-Stat-Per-Second",
                                        "provider-name": "batch",
                                        "time-from":"0",
                                        "time-to":"9007199254740992"
                                      },
                                      "chart-conf": {
                                        "x": "time",
                                        "y": "maxValue",
                                        "color": "None",
                                        "mode": "stack",
                                        "gadget-name": "${toId('$sensorType')}-historical-value-chart-max",
                                        "chart-name": "bar-chart"
                                      }
                                    }
                                ]]>
                            </artifact>
                            <artifact file="gadget.json">
                                <![CDATA[
                                {
                                    "id": "${toId('$sensorType')}-historical-value-chart-max",
                                    "title": "${toId('$sensorType')}-historical-value-chart-max",
                                    "type": "gadget",
                                    "thumbnail": "gadget/${toId('$sensorType')}-historical-value-chart-max/index.png",
                                    "data": {
                                        "url": "gadget/${toId('$sensorType')}-historical-value-chart-max/index.xml"
                                    },
                                    "listen": {
                                      "subscriber": {
                                        "type": "time-range",
                                        "description": "Used for listen to get time range from time-range picker"
                                      }
                                    }
                                }
                                ]]>
                            </artifact>
                            <artifact file="js/gadget-core.js">
                                <![CDATA[
                                   /*
                                    * Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
                                    *
                                    * Licensed under the Apache License, Version 2.0 (the "License");
                                    * you may not use this file except in compliance with the License.
                                    * You may obtain a copy of the License at
                                    *
                                    * http://www.apache.org/licenses/LICENSE-2.0
                                    *
                                    * Unless required by applicable law or agreed to in writing, software
                                    * distributed under the License is distributed on an "AS IS" BASIS,
                                    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                    * See the License for the specific language governing permissions and
                                    * limitations under the License.
                                    */
                                    var conf;
                                    var drawGadget;
                                    var refreshIntervalId;

                                    $(function () {
                                    var gadgetLocation = '/portal/store/carbon.super/fs/gadget/${toId('$sensorType')}-historical-value-chart-max';
                                        var schema;
                                        var pref = new gadgets.Prefs();

                                        var refreshInterval;
                                        var providerData;

                                        var CHART_CONF = 'chart-conf';
                                        var PROVIDER_CONF = 'provider-conf';

                                        var REFRESH_INTERVAL = 'refreshInterval';

                                    var init = function () {
                                        $.ajax({
                                            url: gadgetLocation + '/conf.json',
                                            method: "GET",
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                                conf = JSON.parse(data);
                                                $.ajax({
                                                    url: gadgetLocation + '/gadget-controller.jag?action=getSchema',
                                                    method: "POST",
                                                    data: JSON.stringify(conf),
                                                    contentType: "application/json",
                                                    async: false,
                                                    success: function (data) {
                                                        schema = data;
                                                    }
                                                });

                                                getProviderData();

                                               }
                                           });
                                    }

                                    var getProviderData = function (){
                                        $.ajax({
                                            url: gadgetLocation + '/gadget-controller.jag?action=getData',
                                            method: "POST",
                                            data: JSON.stringify(conf),
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                            providerData = data;
                                            }
                                        });
                                    }


                                        drawGadget = function (){

                                        draw('#canvas', conf[CHART_CONF], schema, providerData);
                                        refreshIntervalId = setInterval(function() {
                                            update(getProviderData);
                                        },pref.getInt(REFRESH_INTERVAL));

                                    }
                                        init();
                                        drawGadget();
                                    });

                                    gadgets.HubSettings.onConnect = function () {
                                        gadgets.Hub.subscribe("subscriber", function (topic, data, subscriber) {
                                            console.log("-conf--"+ conf["provider-conf"]["time-from"]);
                                            conf["provider-conf"]["time-from"] = data.timeFrom;
                                            conf["provider-conf"]["time-to"] =  data.timeTo;
                                            if(refreshIntervalId) {
                                                clearInterval(refreshIntervalId);
                                            }
                                            if(drawGadget){
                                                drawGadget();
                                            }
                                        });
                                    };
                                ]]>
                            </artifact>
                        </artifacts>
                    </config>
                </template>
                <template type="gadget">
                    <config>
                        <properties>
                            <property name="directoryName">${toId('$sensorType')}-historical-value-chart-total</property>
                            <property name="templateDirectory">HistoricalValueChart</property>
                        </properties>
                        <artifacts>
                            <artifact file="conf.json">
                                <![CDATA[
                                    {
                                      "provider-conf": {
                                        "control1": "default value",
                                        "tableName": "Service-${toId('$sensorType')}-Stat-Per-Second",
                                        "provider-name": "batch",
                                        "time-from":"0",
                                        "time-to":"9007199254740992"
                                      },
                                      "chart-conf": {
                                        "x": "time",
                                        "y": "total",
                                        "color": "None",
                                        "mode": "stack",
                                        "gadget-name": "${toId('$sensorType')}-historical-value-chart-total",
                                        "chart-name": "bar-chart"
                                      }
                                    }
                                ]]>
                            </artifact>
                            <artifact file="gadget.json">
                                <![CDATA[
                                {
                                    "id": "${toId('$sensorType')}-historical-value-chart-total",
                                    "title": "${toId('$sensorType')}-historical-value-chart-total",
                                    "type": "gadget",
                                    "thumbnail": "gadget/${toId('$sensorType')}-historical-value-chart-total/index.png",
                                    "data": {
                                        "url": "gadget/${toId('$sensorType')}-historical-value-chart-total/index.xml"
                                    },
                                    "listen": {
                                      "subscriber": {
                                        "type": "time-range",
                                        "description": "Used for listen to get time range from time-range picker"
                                      }
                                    }
                                }
                                ]]>
                            </artifact>
                            <artifact file="js/gadget-core.js">
                                <![CDATA[
                                   /*
                                    * Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
                                    *
                                    * Licensed under the Apache License, Version 2.0 (the "License");
                                    * you may not use this file except in compliance with the License.
                                    * You may obtain a copy of the License at
                                    *
                                    * http://www.apache.org/licenses/LICENSE-2.0
                                    *
                                    * Unless required by applicable law or agreed to in writing, software
                                    * distributed under the License is distributed on an "AS IS" BASIS,
                                    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                    * See the License for the specific language governing permissions and
                                    * limitations under the License.
                                    */
                                    var conf;
                                    var drawGadget;
                                    var refreshIntervalId;

                                    $(function () {
                                    var gadgetLocation = '/portal/store/carbon.super/fs/gadget/${toId('$sensorType')}-historical-value-chart-total';
                                        var schema;
                                        var pref = new gadgets.Prefs();

                                        var refreshInterval;
                                        var providerData;

                                        var CHART_CONF = 'chart-conf';
                                        var PROVIDER_CONF = 'provider-conf';

                                        var REFRESH_INTERVAL = 'refreshInterval';

                                    var init = function () {
                                        $.ajax({
                                            url: gadgetLocation + '/conf.json',
                                            method: "GET",
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                                conf = JSON.parse(data);
                                                $.ajax({
                                                    url: gadgetLocation + '/gadget-controller.jag?action=getSchema',
                                                    method: "POST",
                                                    data: JSON.stringify(conf),
                                                    contentType: "application/json",
                                                    async: false,
                                                    success: function (data) {
                                                        schema = data;
                                                    }
                                                });

                                                getProviderData();

                                               }
                                           });
                                    }

                                    var getProviderData = function (){
                                        $.ajax({
                                            url: gadgetLocation + '/gadget-controller.jag?action=getData',
                                            method: "POST",
                                            data: JSON.stringify(conf),
                                            contentType: "application/json",
                                            async: false,
                                            success: function (data) {
                                            providerData = data;
                                            }
                                        });
                                    }


                                        drawGadget = function (){

                                        draw('#canvas', conf[CHART_CONF], schema, providerData);
                                        refreshIntervalId = setInterval(function() {
                                            update(getProviderData);
                                        },pref.getInt(REFRESH_INTERVAL));

                                    }
                                        init();
                                        drawGadget();
                                    });

                                    gadgets.HubSettings.onConnect = function () {
                                        gadgets.Hub.subscribe("subscriber", function (topic, data, subscriber) {
                                            console.log("-conf--"+ conf["provider-conf"]["time-from"]);
                                            conf["provider-conf"]["time-from"] = data.timeFrom;
                                            conf["provider-conf"]["time-to"] =  data.timeTo;
                                            if(refreshIntervalId) {
                                                clearInterval(refreshIntervalId);
                                            }
                                            if(drawGadget){
                                                drawGadget();
                                            }
                                        });
                                    };
                                ]]>
                            </artifact>
                        </artifacts>
                    </config>
                </template>
                <template type="gadget">
                    <config>
                        <properties>
                            <property name="directoryName">Time_Range_Picker</property>
                            <property name="templateDirectory">Time_Range_Picker</property>
                        </properties>
                    </config>
                </template>
                <template type="dashboard">
                        <config>
                            <properties>
                                <property name="dashboardId">${toId('$sensorType')}-historical-analytics-dashboard</property>
                            </properties>
                            <content>
                               <![CDATA[
                                   {
                                      "id": "${toId('$sensorType')}-historical-analytics-dashboard",
                                      "title": "Historical Analytics: ${toId('$sensorType')}",
                                      "description": "",
                                      "permissions": {
                                        "viewers": [
                                          "Internal/everyone"
                                        ],
                                        "editors": [
                                          "Internal/everyone"
                                        ]
                                      },
                                      "pages": [
                                        {
                                          "id": "landing",
                                          "title": "Home",
                                          "layout": {
                                            "content": {
                                              "loggedIn": {
                                                "blocks": [
                                                  {
                                                    "id": "a",
                                                    "x": 0,
                                                    "y": 2,
                                                    "width": 4,
                                                    "height": 5,
                                                    "banner": false
                                                  },
                                                  {
                                                    "id": "b",
                                                    "x": 4,
                                                    "y": 2,
                                                    "width": 4,
                                                    "height": 5,
                                                    "banner": false
                                                  },
                                                  {
                                                    "id": "c",
                                                    "x": 8,
                                                    "y": 2,
                                                    "width": 4,
                                                    "height": 5,
                                                    "banner": false
                                                  },
                                                  {
                                                    "id": "f",
                                                    "x": 1,
                                                    "y": 0,
                                                    "width": 9,
                                                    "height": 2,
                                                    "banner": false
                                                  }
                                                ]
                                              }
                                            },
                                            "fluidLayout": false
                                          },
                                          "isanon": false,
                                          "content": {
                                            "default": {
                                              "a": [
                                                {
                                                  "id": "${toId('$sensorType')}-historical-value-chart-min",
                                                  "content": {
                                                    "id": "${toId('$sensorType')}-historical-value-chart-min",
                                                    "title": "${toId('$sensorType')}-historical-value-chart-min",
                                                    "type": "gadget",
                                                    "thumbnail": "fs://gadget/${toId('$sensorType')}-historical-value-chart-min/index.png",
                                                    "data": {
                                                      "url": "fs://gadget/${toId('$sensorType')}-historical-value-chart-min/index.xml"
                                                    },
                                                    "listen": {
                                                      "subscriber": {
                                                        "type": "time-range",
                                                        "description": "Used for listen to get time range from time-range picker",
                                                        "on": [
                                                          {
                                                            "from": "Time_Range_Picker-0",
                                                            "event": "range-selected"
                                                          }
                                                        ]
                                                      }
                                                    },
                                                    "styles": {
                                                      "no_heading": false,
                                                      "hide_gadget": false,
                                                      "titlePosition": "left",
                                                      "title": "${toId('$sensorType')}-historical-value-chart-min"
                                                    },
                                                    "options": {
                                                      "refreshInterval": {
                                                        "type": "STRING",
                                                        "title": "Refresh Interval",
                                                        "value": "10",
                                                        "options": [],
                                                        "required": false
                                                      }
                                                    },
                                                    "locale_titles": {
                                                      "en-US": "${toId('$sensorType')}-historical-value-chart-min"
                                                    },
                                                    "settings": {
                                                      "priority": "0"
                                                    }
                                                  }
                                                }
                                              ],
                                              "b": [
                                                {
                                                  "id": "${toId('$sensorType')}-historical-value-chart-max",
                                                  "content": {
                                                    "id": "${toId('$sensorType')}-historical-value-chart-max",
                                                    "title": "${toId('$sensorType')}-historical-value-chart-max",
                                                    "type": "gadget",
                                                    "thumbnail": "fs://gadget/${toId('$sensorType')}-historical-value-chart-max/index.png",
                                                    "data": {
                                                      "url": "fs://gadget/${toId('$sensorType')}-historical-value-chart-max/index.xml"
                                                    },
                                                    "listen": {
                                                      "subscriber": {
                                                        "type": "time-range",
                                                        "description": "Used for listen to get time range from time-range picker",
                                                        "on": [
                                                          {
                                                            "from": "Time_Range_Picker-0",
                                                            "event": "range-selected"
                                                          }
                                                        ]
                                                      }
                                                    },
                                                    "styles": {
                                                      "no_heading": false,
                                                      "hide_gadget": false,
                                                      "titlePosition": "left",
                                                      "title": "${toId('$sensorType')}-historical-value-chart-max"
                                                    },
                                                    "options": {
                                                      "refreshInterval": {
                                                        "type": "STRING",
                                                        "title": "Refresh Interval",
                                                        "value": "10",
                                                        "options": [],
                                                        "required": false
                                                      }
                                                    },
                                                    "locale_titles": {
                                                      "en-US": "${toId('$sensorType')}-historical-value-chart-max"
                                                    },
                                                    "settings": {
                                                      "priority": "5"
                                                    }
                                                  }
                                                }
                                              ],
                                              "c": [
                                                {
                                                  "id": "${toId('$sensorType')}-historical-value-chart-total",
                                                  "content": {
                                                    "id": "${toId('$sensorType')}-historical-value-chart-total",
                                                    "title": "${toId('$sensorType')}-historical-value-chart-total",
                                                    "type": "gadget",
                                                    "thumbnail": "fs://gadget/${toId('$sensorType')}-historical-value-chart-total/index.png",
                                                    "data": {
                                                      "url": "fs://gadget/${toId('$sensorType')}-historical-value-chart-total/index.xml"
                                                    },
                                                    "listen": {
                                                      "subscriber": {
                                                        "type": "time-range",
                                                        "description": "Used for listen to get time range from time-range picker",
                                                        "on": [
                                                          {
                                                            "from": "Time_Range_Picker-0",
                                                            "event": "range-selected"
                                                          }
                                                        ]
                                                      }
                                                    },
                                                    "styles": {
                                                      "no_heading": false,
                                                      "hide_gadget": false,
                                                      "titlePosition": "left",
                                                      "title": "${toId('$sensorType')}-historical-value-chart-total"
                                                    },
                                                    "options": {
                                                      "refreshInterval": {
                                                        "type": "STRING",
                                                        "title": "Refresh Interval",
                                                        "value": "10",
                                                        "options": [],
                                                        "required": false
                                                      }
                                                    },
                                                    "locale_titles": {
                                                      "en-US": "${toId('$sensorType')}-historical-value-chart-total"
                                                    },
                                                    "settings": {
                                                      "priority": "5"
                                                    }
                                                  }
                                                }
                                              ],
                                              "f": [
                                                {
                                                  "id": "Time_Range_Picker-0",
                                                  "content": {
                                                    "id": "Time_Range_Picker",
                                                    "title": "Time Range Picker",
                                                    "type": "gadget",
                                                    "category": "Widgets",
                                                    "thumbnail": "fs://gadget/Time_Range_Picker/index.png",
                                                    "data": {
                                                      "url": "fs://gadget/Time_Range_Picker/index.xml"
                                                    },
                                                    "styles": {
                                                      "no_heading": false,
                                                      "hide_gadget": false,
                                                      "titlePosition": "left",
                                                      "title": "Time Range Picker"
                                                    },
                                                    "notify": {
                                                      "range-selected": {
                                                        "type": "time-range",
                                                        "description": "This notifies when time range is selected"
                                                      }
                                                    },
                                                    "options": {},
                                                    "locale_titles": {
                                                      "en-US": "Time Range Picker"
                                                    },
                                                    "settings": {
                                                      "priority": "0"
                                                    }
                                                  }
                                                }
                                              ]
                                            },
                                            "anon": {}
                                          }
                                        }
                                      ],
                                      "menu": [
                                        {
                                          "id": "landing",
                                          "isanon": false,
                                          "ishidden": false,
                                          "title": "Home",
                                          "subordinates": []
                                        }
                                      ],
                                      "hideAllMenuItems": false,
                                      "identityServerUrl": "",
                                      "accessTokenUrl": "",
                                      "apiKey": "",
                                      "apiSecret": "",
                                      "theme": "Default Theme",
                                      "isUserCustom": false,
                                      "isEditorEnable": true,
                                      "banner": {
                                        "globalBannerExists": false,
                                        "customBannerExists": false
                                      },
                                      "landing": "landing",
                                      "isanon": false,
                                      "defaultPriority": "5"
                                    }

                               ]]>
                            </content>
                        </config>
                </template>
            </templates>
            <streamMappings>
                <streamMapping to="org.wso2.iot.devices.sensors.${toId('$sensorType')}:1.0.0"/>
            </streamMappings>
            <parameters>
                <parameter name="sensorType" type="string">
                    <displayName>Sensor Type Name</displayName>
                    <description>The name of the sensor type</description>
                    <defaultValue>Temperature</defaultValue>
                </parameter>
            </parameters>
        </scenario>
    </scenarios>

    <scripts>
        <script src="wso2-commons.js"/>
    </scripts>
</domain>